@model  KavisWeb.Enitites.DbModels.StratejikPlan

@{
    ViewBag.Title = "BirimGosterge";
}
<style type="text/css">

    .sp div {
        border: solid 1px black;
        margin-bottom: 10px;
    }

   
</style>

<div class="row">
    <div class="col">
        <div class="birimListe"></div>
    </div>
</div>

<h4>Sorumlu Olduğunuz Stratejik Plan Öğeleri</h4>
<br />

<div class="sp">
    @if (Model.Amaclar != null)
    {
        foreach (var amac in Model.Amaclar)
        {
            <div class="amac"><strong>AMAÇ</strong> @amac.SiraNo @amac.Baslik</div>
            foreach (var hedef in amac.Hedefler)
            {
                <div class="hedef"><strong>HEDEF</strong> @hedef.SiraNo @hedef.Baslik </div>
                <table class="table table-bordered table-dar table-sm table-striped table-info ">
                    <thead>
                        <tr>
                            <td colspan="20"><h4 class="text-center">GÖSTERGELER</h4></td>
                        </tr>
                        <tr>
                            <th width="45%" rowspan="2">&nbsp;</th>
                            <th rowspan="2">Hedef Etkisi</th>
                            <th rowspan="2">Başlangıç</th>
                            <th colspan="2">2019</th>
                            <th colspan="2">2020</th>
                            <th colspan="2">2021</th>
                            <th colspan="2">2022</th>
                            <th colspan="2">2023</th>
                            <th rowspan="2">İzleme<br>Sıklığı</th>
                            <th rowspan="2">Rapor<br>Sıklığı</th>
                        </tr>
                        <tr>
                            <th style="height:2px;">P</th>
                            <th>G</th>
                            <th>P</th>
                            <th>G</th>
                            <th>P</th>
                            <th>G</th>
                            <th>P</th>
                            <th>G</th>
                            <th>P</th>
                            <th>G</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var gosterge in hedef.Gostergeler)
                        {

                            <tr>
                                <td>@gosterge.Kod @gosterge.Baslik</td>
                                <td>@gosterge.HedefeEtkisi</td>
                                <td>@gosterge.Baslangic</td>
                                <td>@gosterge.Yil1</td>
                                <td>@gosterge.Yil1G</td>
                                <td>@gosterge.Yil2</td>
                                <td>@gosterge.Yil2G</td>
                                <td @gosterge.Yil3></td>
                                <td class="aktifYil" data-id="@gosterge.Id">@gosterge.Yil3G</td>
                                <td>@gosterge.Yil4</td>
                                <td>@gosterge.Yil4G</td>
                                <td>@gosterge.Yil5</td>
                                <td>@gosterge.Yil5G</td>
                                <td>@gosterge.Izleme</td>
                                <td>@gosterge.Rapor</td>
                            </tr>

                        }
                    </tbody>
                </table>

                foreach (var strateji in hedef.Stratejiler)
                {
                    <div class="strateji">@strateji.SiraNo @strateji.Baslik</div>
                }
            }
        }
    }

</div>



<button class="btn btn-primary .btn-birim-gosterge-save"> Kaydet</button>

@section scripts {


    <script type="text/javascript">

        var aktifYil = @ViewBag.AktifYil;

        $(function () {

            //$('td.aktifYil').attr("contenteditable", "true").style("background-color", "#fef2ae");
                      

            $('.btn-birim-gosterge-save').on("click", function () {

                let data = [];

                $('td.aktifYil').each(function (i, v) {
                    let id = v.data("id");
                    let val = v.text();
                    let yil =
                    data.push({ GostergeId: id, Value: val, Yil: '' });
                });

                api_post("api/BirimGosterge", data, function (d) {
                    if (d.Success) {
                        successMessage("Kayıt Yapıldı");
                    } else {
                        errorMessage("Kaydedilemedi:" + d.Message);
                    }
                });

            });

            console.log(birimler);

            $('.birimListe').html(birimListe());
        });

    </script>

}